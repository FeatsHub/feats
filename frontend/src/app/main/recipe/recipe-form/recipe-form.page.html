<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>
      Receta
    </ion-title>
    <ion-buttons slot="end">
        <ion-button (click)="submit()">Done</ion-button>
    </ion-buttons>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/recipes" ></ion-back-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">

  <form [formGroup]="recipeForm">
    <ion-icon name="pencil-outline" class="edit-pencil"></ion-icon>
    <app-image-picker 
      (selectImage)="imageSelected($event)"
      [imageUrl]="selectedImage"
      [width]="'100%'"
      [height]="'200px'"
    ></app-image-picker>
    <div class="plate-content">
      <ion-list>
        <ion-item>
          <ion-input 
            formControlName="name"
            labelPlacement="fixed" 
            label="Nombre"
            labelPlacement="floating">
          </ion-input>
        </ion-item>
      
        <ion-item>
          <ion-textarea 
            formControlName="description"
            style="padding-bottom: 20px;"
            label="Descripcion"
            labelPlacement="floating">
          </ion-textarea>
        </ion-item>

        <ion-item>
          <ion-input 
            formControlName="diners"
            type="number" 
            label="Comensales"
            labelPlacement="floating">
          </ion-input>
        </ion-item>

        <ion-item>
            <ion-input
            formControlName="time"
            label="Tiempo (min)"
            type="number"
            labelPlacement="floating">
            </ion-input>
        </ion-item>

        <ion-item>
          <ion-select
            formControlName="category"
            (ionChange)="handleChangeCategorySelect($event)"
            labelPlacement="fixed"
            label="Categorias"
            [multiple]="true">
            <ion-select-option 
              *ngFor="let recipeCategory of recipeCategories" 
              [value]="recipeCategory.id"
              >
              {{recipeCategory.name}}
            </ion-select-option>
          </ion-select>
        </ion-item>

        <ion-item>
          <ion-grid style="margin-top: 10px;width: 350px; position: relative; left: -10px;">
            <ion-row>
              <ion-col>
                <ion-label>Ingredientes</ion-label>
              </ion-col>
            </ion-row>
            <ion-row>
              <ion-col>
                <ion-searchbar
                (ionInput)="handleSearch($event)"
                ></ion-searchbar>
                <ion-list *ngIf="searchedProducts.length == 0 && productName.length > 0">
                  <ion-item
                    (click)="createProduct(productName)">
                    {{productName}}
                  </ion-item>
                </ion-list>
                <ion-list *ngIf="searchedProducts.length != 0">
                  <ion-item
                  *ngFor="let searchedProduct of searchedProducts"
                  (click)="selectProduct(searchedProduct)"
                  >{{searchedProduct.name}}
                  </ion-item>
                </ion-list>
              </ion-col>
            </ion-row>
            <ion-row>
              <ion-col>
                <ion-list
                formArrayName="ingredients"
                *ngIf="ingredients.length != 0">
                  <ion-item
                  *ngFor="let ingredient of ingredients.controls; let i = index"
                  >
                    <ion-grid [formGroupName]="i" style="width: 300px; position: relative; left: -10px;">
                      <ion-row>
                        <ion-col size="auto">
                          <ion-icon style="margin-top: 9px;" name="fast-food-outline"></ion-icon>
                        </ion-col>
                        <ion-col>
                          <ion-label style="margin-top: 9px;">
                            <b>
                              {{ ingredient.value.product_name.charAt(0).toUpperCase() + ingredient.value.product_name.slice(1) }}
                            </b>
                          </ion-label>
                        </ion-col>
                      </ion-row>
                      <ion-row style="margin-top: 10px">
                        <ion-col>
                          <ion-input
                            label="Cantidad"
                            labelPlacement="stacked"
                            style="margin-left: 5px; position:relative; top:-17px"
                            placeholder="Cantidad"
                            type="number"
                            formControlName="quantity"
                          ></ion-input>
                        </ion-col>
                        <ion-col>
                          <ion-input
                          style="margin-left: 5px; position:relative; top:-17px"
                          placeholder="Unidad"
                          label="Unidad"
                          labelPlacement="stacked"
                          formControlName="unit"
                          ></ion-input>
                        </ion-col>
                        <ion-col style="text-align: right;">
                          <ion-button 
                          fill="outline" 
                          color="danger"
                          (click)="ingredients.removeAt(i)"
                          >x</ion-button>
                        </ion-col>
                      </ion-row>
                    </ion-grid>
                  </ion-item>
                </ion-list>
              </ion-col>
            </ion-row>
          </ion-grid>
        </ion-item>
      
      </ion-list>
    </div>
  </form>
</ion-content>
