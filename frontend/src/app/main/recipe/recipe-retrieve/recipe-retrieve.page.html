<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>
      Receta
    </ion-title>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/recipes" ></ion-back-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">

  <ion-fab slot="fixed" vertical="top" horizontal="start">

    <ion-fab-button
      size="small"
      color="light"
      class="recipe-creator-fab"
      [routerLink]="['/profile', recipe.creator.id]"
    >
      <div class="recipe-creator-image"
      [ngStyle]="{
        'background-image': 'url(' + (recipe.creator.image ? recipe.creator.image.image : 'https://ionicframework.com/docs/img/demos/avatar.svg') + ')'
      }"
      ></div>
      <ion-text class="recipe-creator-username">
        {{ recipe.creator.username.length > 6 ? (recipe.creator.username | slice:0:4) + '...' : recipe.creator.username }}
      </ion-text>
    </ion-fab-button>

  </ion-fab>

  <ion-fab slot="fixed" vertical="top" horizontal="end">

    <ion-fab-button
      size="small"
      color="light"
      (click)="saveRecipe(recipe.id)"
    >
      <ion-icon
        *ngIf="!saved"
        name="bookmark-outline">
      </ion-icon>
      <ion-icon
        *ngIf="saved"
        name="bookmark">
      </ion-icon>
    </ion-fab-button>


    <ion-fab-button
      *ngIf="isOwner"
      color="light"
      size="small"
      fill="clear"
      (click)="togglePublic()"
    >
      <ion-icon 
          name="eye-outline"
          *ngIf="recipe.is_public"
      ></ion-icon>
      <ion-icon
          name="eye-off-outline"
          *ngIf="!recipe.is_public"
      ></ion-icon>
    </ion-fab-button>

    <ion-fab-button
        *ngIf="isOwner"
        color="light"
        size="small"
        [routerLink]="['/recipes', recipe.id, 'edit']"
    >
      <ion-icon name="pencil-outline"></ion-icon>
    </ion-fab-button>

    <ion-fab-button
        *ngIf="isOwner"
        size="small"
        (click)="presentDeleteAlert()"
        color="danger"
    >
      <ion-icon name="trash-outline"></ion-icon>
    </ion-fab-button>

  </ion-fab>

  <div class="plate-detail-image"
    [ngStyle]="{'background-image': 'url(' + recipe.image_data.image + ')'}">
  </div>


  <div class="plate-content">
    <h3 class="plate-title">
      {{recipe.name}}
    </h3>
    <div class="recipe-time">
      <ion-icon name="time-outline" class="plate-time-clock"></ion-icon>
      {{recipe.time}} min
    </div>
    
    <p class="plate-description">
      {{ showDescription ? recipe.description : shortDescription }}
      <ion-text (click)="toggleFullDescription()" class="view-more" style="font-weight: bold;">
        {{ showDescription ? 'Ver menos' : 'Ver más' }}
      </ion-text>
    </p>
    


    <ion-segment
      (ionChange)="changeIngredientSegment($event)"
      color="dark"
      class="plate-segment"
      value="ingredient"
      style="margin: 20px 0px"
    >
      <ion-segment-button value="ingredient">
        <ion-label>Ingredientes</ion-label>
      </ion-segment-button>
      <ion-segment-button value="description">
        <ion-label>Pasos</ion-label>
      </ion-segment-button>
    </ion-segment>
    <div
      *ngIf="!isIngredientSegment"
      class="plate-description"
    >
    <ion-accordion-group multiple="true" [value]="['first']">
      <ion-accordion value="first">
        <ion-item slot="header" color="light">
          <ion-label>Paso 1</ion-label>
        </ion-item>
        <div class="ion-padding" slot="content">
          Unas deliciosas albondigas con salsa de almendras como las que hacía tu abuela. No tiene sentido lo buenas que están.

          Unas deliciosas albondigas con salsa de almendras como las que hacía tu abuela. No tiene sentido lo buenas que están. 
        </div>
      </ion-accordion>
      <ion-accordion value="second">
        <ion-item slot="header" color="light">
          <ion-label>Paso 2</ion-label>
        </ion-item>
        <div class="ion-padding" slot="content">
          Unas deliciosas albondigas con salsa de almendras como las que hacía tu abuela. No tiene sentido lo buenas que están.

          Unas deliciosas albondigas con salsa de almendras como las que hacía tu abuela. No tiene sentido lo buenas que están. 
        </div>
      </ion-accordion>
      <ion-accordion value="third">
        <ion-item slot="header" color="light">
          <ion-label>Paso 3</ion-label>
        </ion-item>
        <div class="ion-padding" slot="content">
          Third Content
        </div>
      </ion-accordion>
    </ion-accordion-group>
    </div>
    <div *ngIf="isIngredientSegment">
      <ion-button
        *ngIf="isOwner"
        size="small"
        color="light"
        [routerLink]="['/recipes', recipe.id, 'edit', 'ingredients']"
        class="edit-ingredients"
      >
        <ion-icon size="large" name="pencil-outline"></ion-icon>
      </ion-button>

      <ion-list [inset]="true">
        <ion-item
          *ngFor="let ingredient of recipe.ingredients"
        >
          <ion-grid>
            <ion-row>
              <ion-col size="auto">
                <ion-icon style="margin-top: 17px;" color="primary" name="restaurant-outline"></ion-icon>
              </ion-col>
              <ion-col style="padding: 20px 3px;">
                {{ ingredient.food_name.charAt(0).toUpperCase() + ingredient.food_name.slice(1) }}
              </ion-col>
              <ion-col size="auto" style="color: grey;font-size: 13px;padding: 20px 3px;">
                {{ingredient.quantity}} {{ingredient.unit == "-" ? "" : ingredient.unit}}
              </ion-col>
            </ion-row>
          </ion-grid>
        </ion-item>
      </ion-list>
    </div>
  </div>

</ion-content>
