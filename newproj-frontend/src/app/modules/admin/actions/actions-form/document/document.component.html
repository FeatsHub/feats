<form #formElement
        *ngIf="formService.form.get('data') || (formService.serverErrors$ | async) as serverErrors"
        fxLayout="column"
        fxLayoutAlign="start"
        fxFlex="100"
        class="p-5 bg-white h-full"
        name="form"
        [formGroup]="formService.form.get('data')"
        style="min-height: 500px">

    <mat-error>
<!--        <span>{{errors.error.non_field_errors[0]}}</span>-->
<!--        <app-bcn-error [serverErrors]="serverErrors?.no"-->
<!--                       [control]="formService.form.controls['data']['controls'].identification"></app-bcn-error>-->
    </mat-error>

    <div fxLayout="column" fxFlex="50" fxFlex.lt-sm="100"
         fxLayoutAlign="start start" fxLayoutGap="10px">
        <div class="mb-2">
            <mat-label>Tipus</mat-label>
        </div>
        <app-select-autocomplete
            placeholder="{{'Seleccioni un valor'}}"
            fxFlex="50"
            style="width:100%"
            [required]="false"
            [bgWhite]="true"
            [multiple]="false"
            [canCreate]="false"
            [data]="enumTypeDocument"
            [serverErrors]="serverErrors?.type"
            [control]="formService.form.get('data.type')"
            formControlName="type"
            id="type"
            [matMinLength]="0">
        </app-select-autocomplete>
    </div>


    <div class="mt-5">

        <div ngfDrop selectable="1"
             *ngIf="formService.form.get('data.type').value"
             (lastInvalidsChange)="getInvalids($event)"
             (filesChange)="getFiles($event)"
             class="drop-zone mb-20" maxSize="26214400"
             accept=".doc,.pdf,.jpg,.jpeg,.png,.gif,.odt">
            <p>Arrossega fitxers a qualsevol lloc per pujar-los</p>
            <p>- o -</p>
            <button type="button" mat-raised-button>Seleccionar fitxers</button>
        </div>

        <div class="invalid-files" *ngIf="lastInvalids?.length">
            <h3 class="invalid-files-message" fxLayout="row" fxLayoutAlign="space-between center">
        <span>Està intentant pujar {{ lastInvalids.length }} fitxers no vàlids. La
          mida màxima permesa és de 25MB. Aquests fitxers no s'afegiran.</span>
                <a href="javascript:void(0)" (click)="removeInvalids()">
                    <mat-icon>close</mat-icon>
                </a>
            </h3>

            <table #invalidTable class="invalid-files-table" mat-table [dataSource]="lastInvalids">
                <ng-container matColumnDef="name">
                    <th style="min-width:150px" mat-header-cell *matHeaderCellDef>Nom</th>
                    <td mat-cell class="name-cell" *matCellDef="let item">
                        {{ item.file.name }}
                    </td>
                </ng-container>
                <ng-container matColumnDef="type">
                    <th mat-header-cell *matHeaderCellDef>Tipus</th>
                    <td mat-cell class="name-cell" *matCellDef="let item">
                        {{ item.file.type }}
                    </td>
                </ng-container>
                <ng-container matColumnDef="size">
                    <th mat-header-cell *matHeaderCellDef>Mida</th>
                    <td mat-cell class="name-cell" *matCellDef="let item">
                        {{ item.file.size / 1024 / 1024 | number: "1.0-2" }} MB
                    </td>
                </ng-container>
                <ng-template>
                    <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
                </ng-template>
                <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
            </table>
        </div>


        <div class="fileList" [formGroup]="filesForm" *ngIf="filesForm">
            <div formArrayName="files">
                <div [formGroupName]="i"
                     *ngFor="let file of formAction.form.get('data.documents')['controls'];let i = index"
                     fxLayout="row" fxLayoutGap="20px"
                     class="file flex items-center justify-between">
                    <span>{{typeDictDocument[file.value.type]}} - {{file.value.file_name}}</span>
                        <button mat-icon-button (click)="removeValidFile(i)">
                            <mat-icon class="secondary-text" title="Eliminar" aria-label="Eliminar">delete</mat-icon>
                        </button>
                </div>
            </div>
        </div>
    </div>
</form>
